# /research - Web Research Command with Codex

## Overview
Powerful web research command that leverages Codex CLI's web search capabilities for comprehensive research with parallel execution support.

## Usage
```
/research <topic> [--parallel <count>] [--worktree <branch>]
```

## Examples
```bash
# Single research task
/research "Next.js 15 vs Remix comparison"

# Parallel research on multiple topics
/research "React Server Components" --parallel 3

# Research with worktree for PR
/research "PostgreSQL performance tuning" --worktree feature/postgres-research
```

## Implementation

### Phase 1: Parse Arguments
```bash
# Extract research topic and options
RESEARCH_TOPIC="${1}"
PARALLEL_COUNT="${2:-1}"
WORKTREE_BRANCH="${3:-}"
```

### Phase 2: Setup Environment
```bash
# Create research directory structure
mkdir -p .catlab/research
mkdir -p .catlab/workers

# Generate timestamp and task name
TIMESTAMP=$(date +"%Y%m%d_%H%M%S")
TASK_NAME=$(echo "$RESEARCH_TOPIC" | sed 's/[^a-zA-Z0-9]/_/g' | tr '[:upper:]' '[:lower:]')
```

### Phase 3: Execute Research
```bash
# Research Prompt Template
RESEARCH_PROMPT="Research ${RESEARCH_TOPIC} using web search. Create a comprehensive markdown report with the following structure:

## Research Report: ${RESEARCH_TOPIC}

### Executive Summary
[2-3 sentence overview of the research findings]

### Key Findings
- Main discovery 1
- Main discovery 2
- Main discovery 3

### Detailed Analysis
[In-depth analysis with subsections as needed]

### Technical Specifications
[Versions, requirements, compatibility notes if applicable]

### Comparative Analysis
[If comparing technologies/approaches]

### Implementation Considerations
[Practical insights for implementation]

### References & Sources
**CRITICAL**: Include FULL URLs for all sources:
- [Official Documentation](https://full-url-here.com)
- [Research Paper](https://complete-url.com)
- [Blog Post](https://authoritative-source.com)

### Conclusion
[Summary and actionable recommendations]

**IMPORTANT INSTRUCTIONS**:
1. Replace PLACEHOLDER in filename with your process ID
2. Always include complete, clickable URLs (https://)
3. Include publication dates where available
4. Prioritize official documentation
5. Verify all technical claims with sources

Save output to: .catlab/research/${TIMESTAMP}_BASHID_${TASK_NAME}.md"

# Execute with background support
codex exec -s danger-full-access \
  -c 'tools.web_search=true' \
  -c model_reasoning_effort="medium" \
  "${RESEARCH_PROMPT}" &

BASH_ID=$!
```

### Phase 4: Parallel Execution (if requested)
```bash
if [ $PARALLEL_COUNT -gt 1 ]; then
  # Split research into sub-topics
  for i in $(seq 1 $PARALLEL_COUNT); do
    SUB_TOPIC="${RESEARCH_TOPIC} - Aspect ${i}"
    SUB_TIMESTAMP=$(date +"%Y%m%d_%H%M%S")
    SUB_TASK="parallel_${i}_${TASK_NAME}"

    codex exec -s danger-full-access \
      -c 'tools.web_search=true' \
      -c model_reasoning_effort="medium" \
      "Research specific aspect ${i} of ${RESEARCH_TOPIC}.
      Focus on different angles/perspectives.
      Save to: .catlab/research/${SUB_TIMESTAMP}_BASHID_${SUB_TASK}.md" &

    echo "Launched parallel worker ${i}: PID $!"
  done
fi
```

### Phase 5: GitHub Worktree Integration (if requested)
```bash
if [ -n "$WORKTREE_BRANCH" ]; then
  # Setup worktree for isolated work
  git worktree add .catlab/worktrees/${WORKTREE_BRANCH} -b ${WORKTREE_BRANCH}

  # Create research in worktree
  cd .catlab/worktrees/${WORKTREE_BRANCH}

  # Copy research outputs when complete
  # Monitor with BashOutput tool
fi
```

### Phase 6: Monitor & Aggregate
```bash
# Use BashOutput to monitor progress
# Wait for all background jobs
wait

# Aggregate results if parallel
if [ $PARALLEL_COUNT -gt 1 ]; then
  AGGREGATE_FILE=".catlab/research/${TIMESTAMP}_aggregate_${TASK_NAME}.md"
  echo "# Aggregated Research Report: ${RESEARCH_TOPIC}" > $AGGREGATE_FILE
  echo "" >> $AGGREGATE_FILE

  # Combine all parallel research outputs
  for file in .catlab/research/*parallel_*${TASK_NAME}*.md; do
    cat "$file" >> $AGGREGATE_FILE
    echo -e "\n---\n" >> $AGGREGATE_FILE
  done
fi
```

### Phase 7: Create PR (if worktree)
```bash
if [ -n "$WORKTREE_BRANCH" ]; then
  cd .catlab/worktrees/${WORKTREE_BRANCH}

  # Commit research
  git add .catlab/research/
  git commit -m "research: ${RESEARCH_TOPIC}

  - Comprehensive web research with citations
  - Full URL references included
  - Generated by /research command

  Co-Authored-By: Codex <noreply@anthropic.com>"

  # Push and create PR
  git push -u origin ${WORKTREE_BRANCH}
  gh pr create --title "Research: ${RESEARCH_TOPIC}" \
    --body "## Research Report

    Automated research conducted via /research command.

    ### Topics Covered
    - ${RESEARCH_TOPIC}

    ### Method
    - Codex CLI with web_search enabled
    - Parallel execution: ${PARALLEL_COUNT} workers

    See attached research reports in .catlab/research/"
fi
```

## Options

### --parallel <count>
Launch multiple Codex workers to research different aspects in parallel.

### --worktree <branch>
Create research in a git worktree and automatically create a PR.

### --reasoning <level>
Override default reasoning level (minimal|low|medium|high).

### --format <type>
Output format: markdown (default), json, yaml.

## Worker Registry
Track all active research workers in `.catlab/workers/worker_registry.json`:
```json
{
  "research_workers": [{
    "bash_id": "abc123",
    "timestamp": "20250927_120000",
    "topic": "Next.js 15",
    "status": "running",
    "output": ".catlab/research/20250927_120000_abc123_nextjs15.md"
  }]
}
```

## Safety Considerations
- Uses `danger-full-access` for development
- Consider implementing sandboxed mode for production
- All URLs are validated before inclusion
- Parallel execution limited to prevent resource exhaustion

## Integration Points
- Works with existing `codex-research.sh` infrastructure
- Compatible with TodoWrite tracking
- Integrates with worker monitoring via BashOutput
- Supports GitHub workflow via worktrees and PRs

## Success Criteria
- ✅ Web search enabled and functioning
- ✅ Full URLs in all references
- ✅ Parallel execution capability
- ✅ GitHub worktree integration
- ✅ Structured markdown output
- ✅ Worker tracking and monitoring